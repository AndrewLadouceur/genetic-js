<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>genetic-js</title>
	<script src="lib/genetic.js"></script>

	<script>
	
	var ga = Genetic.create();
	
	ga.optimize = Genetic.Optimize.Maximize;
	ga.select1 = Genetic.Select1.Tournament;
	ga.select2 = Genetic.Select2.Tournament;
	
	ga.seed = function() {

		function randomString(len) {
			var text = "";
			var charset = "abcdefghijklmnopqrstuvwxyz0123456789";
			for(var i=0;i<len;i++)
				text += charset.charAt(Math.floor(Math.random() * charset.length));
			
			return text;
		}
		
		// create random strings that are equal in length to solution
		return randomString(this.userData["solution"].length);
	};
	
	ga.mutate = function(entity) {
		
		function replaceAt(str, index, character) {
		    return str.substr(0, index) + character + str.substr(index+character.length);
		}
		
		// chromosomal drift
		var i = Math.floor(Math.random()*entity.length)		
		return replaceAt(entity, i, String.fromCharCode(entity.charCodeAt(i) + (Math.floor(Math.random()*2) ? 1 : -1)));
	};
	
	ga.crossover = function(mother, father) {
		// two-point crossover
		
		var len = mother.length;
		var ca = Math.floor(Math.random()*len);
		var cb = Math.floor(Math.random()*len);		
		if (ca > cb) {
			var tmp = cb;
			cb = ca;
			ca = tmp;
		}
			
		var son = father.substr(0,ca) + mother.substr(ca, cb-ca) + father.substr(cb);
		var daughter = mother.substr(0,ca) + father.substr(ca, cb-ca) + mother.substr(cb);
		
		return [son, daughter];
	};
	
	ga.fitness = function(entity) {
		var fitness = 0;
		
		var i;
		for (i=0;i<entity.length;++i) {
			// increase fitness for each character that matches
			if (entity[i] == this.userData["solution"][i])
				fitness += 1;
			
			// award fractions of a point as we get warmer
			fitness += (127-Math.abs(entity.charCodeAt(i) - this.userData["solution"].charCodeAt(i)))/50;
		}

		return fitness;
	};
	
	ga.generation = function(pop, generation, stats) {
		console.log("avg: " + stats.mean.toPrecision(8) + "  best entity: " + pop[0].entity);
		
		// stop running once we've reached the solution
		return pop[0].entity != this.userData["solution"];
	};
	
	var config = {
		"iterations": 4000
		, "size": 250
		, "crossover": 0.3
		, "mutation": 0.3
	};
	
	var userData = {
		"solution": "This is a test to see that it works"
	};
	
	ga.evolve(config, userData);
	
	</script>
	
</head>
<body>
	
	
</body>
</html>