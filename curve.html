<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>genetic-js</title>
	<script src="lib/genetic.js"></script>

	<script>
	
	var ga = Genetic.create();
	
	ga.optimize = Genetic.Optimize.Minimize;
	ga.select1 = Genetic.Select1.Tournament2;
	ga.select2 = Genetic.Select2.FittestRandom;
	
	ga.seed = function() {
		
		var a = [];
		// create coefficients for polynomial with values between (-0.5, 0.5)
		
		var i;
		for (i=0;i<this.userData["terms"];++i) {
			a.push(Math.random()-0.5);
		}
		
		return a;
	};
	
	ga.mutate = function(entity) {
		
		// allow chromosomal drift with this range (-0.05, 0.05)
		var drift = ((Math.random()-0.5)*2)*0.05;
		
		var i = Math.floor(Math.random()*entity.length);
		entity[i] += drift;
		
		return entity;
	};
	
	ga.crossover = function(mother, father) {

		// crossover via interpolation
		function lerp(a, b, p) {
			return a + (b-a)*p;
		}
		
		var len = mother.length;
		var i = Math.floor(Math.random()*len);
		var r = Math.random();
		var son = [].concat(father);
		var daughter = [].concat(mother);
		
		son[i] = lerp(father[i], mother[i], r);
		daughter[i] = lerp(mother[i], father[i], r);
		
		return [son, daughter];
	};
	
	ga.fitness = function(entity) {
		
		// example 3 term polynomial: cx^0 + bx^1 + ax^2
		function evaluatePoly(x) {
			var s = 0;
			var p = 1;
			var i;
			for (i=0;i<entity.length;++i) {
				s += p*entity[i];
				p *= x;
			}
			 
			return s;
		}

		var sumSqErr = 0;
		var m = 2*3.1415927;
		var step = 3.1415927/4;
		var x;
		for (x=0;x<m;x+=step) {
			var err = evaluatePoly(x) - Math.sin(x);
			sumSqErr += err*err;
		}
		
		return Math.sqrt(sumSqErr);
	};
	
	
	ga.generation = function(pop, generation, stats) {
	};
	
	ga.notification = function(pop, generation, stats, isFinished) {
		console.log(generation + "  stddev(" + stats.stdev.toPrecision(6) + ")  avg(" + stats.mean.toPrecision(6) + ")  best entity(" + pop[0].fitness.toPrecision(6) + ")");
		
		function poly(entity) {
			var a = [];
			var i;
			for (i=entity.length-1;i>=0;--i) {
				a.push(entity[i] + "(x^" + i + ")");
			}
			return a.join(" + ");
		}
		
		if (isFinished) {	
			console.log(poly(pop[0].entity));
		}
		
	};
	
	var config = {
		"iterations": 2000
		, "size": 250
		, "crossover": 0.3
		, "mutation": 1.0
	};
	
	var userData = {
		"terms": 4
	};
	
	ga.evolve(config, userData);
	
	
	
	</script>
	
</head>
<body>
	
	
</body>
</html>